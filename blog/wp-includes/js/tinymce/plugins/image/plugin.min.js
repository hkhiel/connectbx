!function(){var e={},t=function(t,i,n){if("string"!=typeof t)throw"module id must be a string";if(void 0===i)throw"no dependencies for "+t;if(void 0===n)throw"no definition function for "+t;e[t]={deps:i,defn:n,instance:void 0}},i=function(t){var n=e[t];if(void 0===n)throw"module ["+t+"] was undefined";return void 0===n.instance&&function(t){for(var n=e[t],a=n.deps,o=n.defn,r=a.length,l=new Array(r),s=0;s<r;++s)l[s]=i(a[s]);var c=o.apply(null,l);if(void 0===c)throw"module ["+t+"] returned undefined";n.instance=c}(t),n.instance},n=function(e,t){for(var n=e.length,a=new Array(n),o=0;o<n;++o)a.push(i(e[o]));t.apply(null,t)};({}).bolt={module:{api:{define:t,require:n,demand:i}}};var a=t;!function(e,t){a(e,[],function(){return t})}("global!tinymce.util.Tools.resolve",tinymce.util.Tools.resolve),a("tinymce.core.Env",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.Env")}),a("tinymce.core.PluginManager",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.PluginManager")}),a("tinymce.core.util.JSON",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.util.JSON")}),a("tinymce.core.util.Tools",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.util.Tools")}),a("tinymce.core.util.XHR",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.util.XHR")}),a("tinymce.plugins.image.Plugin",["tinymce.core.Env","tinymce.core.PluginManager","tinymce.core.util.JSON","tinymce.core.util.Tools","tinymce.core.util.XHR"],function(e,t,i,n,a){return t.add("image",function(t){function o(e,t,i){function a(e,i){return i=i||[],n.each(e,function(e){var n={text:e.text||e.title};e.menu?n.menu=a(e.menu):(n.value=e.value,t(n)),i.push(n)}),i}return a(e,i||[])}function r(e){return function(){var n=t.settings.image_list;"string"==typeof n?a.send({url:n,success:function(t){e(i.parse(t))}}):"function"==typeof n?n(e):e(n)}}function l(i){function a(){var e,t,i,n;e=m.find("#width")[0],t=m.find("#height")[0],e&&t&&(i=e.value(),n=t.value(),m.find("#constrain")[0].checked()&&h&&f&&i&&n&&(h!=i?(n=Math.round(i/h*n),isNaN(n)||t.value(n)):(i=Math.round(n/f*i),isNaN(i)||e.value(i))),h=i,f=n)}function r(){var e,i;g(),a(),(y=n.extend(y,m.toJSON())).alt||(y.alt=""),y.title||(y.title=""),""===y.width&&(y.width=null),""===y.height&&(y.height=null),y.style||(y.style=null),y={src:y.src,alt:y.alt,title:y.title,width:y.width,height:y.height,style:y.style,caption:y.caption,class:y.class},t.undoManager.transact(function(){if(y.src){if(""===y.title&&(y.title=null),u?b.setAttribs(u,y):(y.id="__mcenew",t.focus(),t.selection.setContent(b.createHTML("img",y)),u=b.get("__mcenew"),b.setAttrib(u,"id",null)),t.editorUpload.uploadImagesAuto(),!1===y.caption&&b.is(u.parentNode,"figure.image")&&(e=u.parentNode,b.insertAfter(u,e),b.remove(e)),!0!==y.caption)!function(e){function i(){e.onload=e.onerror=null,t.selection&&(t.selection.select(e),t.nodeChanged())}e.onload=function(){y.width||y.height||!x||b.setAttribs(e,{width:e.clientWidth,height:e.clientHeight}),i()},e.onerror=i}(u);else if(!b.is(u.parentNode,"figure.image")){i=u,u=u.cloneNode(!0),(e=b.create("figure",{class:"image"})).appendChild(u),e.appendChild(b.create("figcaption",{contentEditable:!0},"Caption")),e.contentEditable=!1;var n=b.getParent(i,function(e){return t.schema.getTextBlockElements()[e.nodeName]});n?b.split(n,i,e):b.replace(e,i),t.selection.select(e)}}else u&&(b.remove(u),t.focus(),t.nodeChanged())})}function l(e){return e&&(e=e.replace(/px$/,"")),e}function s(e){var i,a,o,r=e.meta||{};p&&p.value(t.convertURL(this.value(),"src")),n.each(r,function(e,t){m.find("#"+t).value(e)}),r.width||r.height||(i=t.convertURL(this.value(),"src"),a=t.settings.image_prepend_url,o=new RegExp("^(?:[a-z]+:)?//","i"),a&&!o.test(i)&&i.substring(0,a.length)!==a&&(i=a+i),this.value(i),function(e,t){function i(e,i){n.parentNode&&n.parentNode.removeChild(n),t({width:e,height:i})}var n=document.createElement("img");n.onload=function(){i(Math.max(n.width,n.clientWidth),Math.max(n.height,n.clientHeight))},n.onerror=function(){i()};var a=n.style;a.visibility="hidden",a.position="fixed",a.bottom=a.left=0,a.width=a.height="auto",document.body.appendChild(n),n.src=e}(t.documentBaseURI.toAbsolute(this.value()),function(e){e.width&&e.height&&x&&(h=e.width,f=e.height,m.find("#width").value(h),m.find("#height").value(f))}))}function c(e){if(e.margin){var t=e.margin.split(" ");switch(t.length){case 1:e["margin-top"]=e["margin-top"]||t[0],e["margin-right"]=e["margin-right"]||t[0],e["margin-bottom"]=e["margin-bottom"]||t[0],e["margin-left"]=e["margin-left"]||t[0];break;case 2:e["margin-top"]=e["margin-top"]||t[0],e["margin-right"]=e["margin-right"]||t[1],e["margin-bottom"]=e["margin-bottom"]||t[0],e["margin-left"]=e["margin-left"]||t[1];break;case 3:e["margin-top"]=e["margin-top"]||t[0],e["margin-right"]=e["margin-right"]||t[1],e["margin-bottom"]=e["margin-bottom"]||t[2],e["margin-left"]=e["margin-left"]||t[1];break;case 4:e["margin-top"]=e["margin-top"]||t[0],e["margin-right"]=e["margin-right"]||t[1],e["margin-bottom"]=e["margin-bottom"]||t[2],e["margin-left"]=e["margin-left"]||t[3]}delete e.margin}return e}function g(){function e(e){return e.length>0&&/^[0-9]+$/.test(e)&&(e+="px"),e}if(t.settings.image_advtab){var i=m.toJSON(),n=b.parseStyle(i.style);n=c(n),i.vspace&&(n["margin-top"]=n["margin-bottom"]=e(i.vspace)),i.hspace&&(n["margin-left"]=n["margin-right"]=e(i.hspace)),i.border&&(n["border-width"]=e(i.border)),m.find("#style").value(b.serializeStyle(b.parseStyle(b.serializeStyle(n))))}}var m,u,d,h,f,p,v,y={},b=t.dom,x=!1!==t.settings.image_dimensions;u=t.selection.getNode(),(d=b.getParent(u,"figure.image"))&&(u=b.select("img",d)[0]),u&&("IMG"!=u.nodeName||u.getAttribute("data-mce-object")||u.getAttribute("data-mce-placeholder"))&&(u=null),u&&(h=b.getAttrib(u,"width"),f=b.getAttrib(u,"height"),y={src:b.getAttrib(u,"src"),alt:b.getAttrib(u,"alt"),title:b.getAttrib(u,"title"),class:b.getAttrib(u,"class"),width:h,height:f,caption:!!d}),i&&(p={type:"listbox",label:"Image list",values:o(i,function(e){e.value=t.convertURL(e.value||e.url,"src")},[{text:"None",value:""}]),value:y.src&&t.convertURL(y.src,"src"),onselect:function(e){var t=m.find("#alt");(!t.value()||e.lastControl&&t.value()==e.lastControl.text())&&t.value(e.control.text()),m.find("#src").value(e.control.value()).fire("change")},onPostRender:function(){p=this}}),t.settings.image_class_list&&(v={name:"class",type:"listbox",label:"Class",values:o(t.settings.image_class_list,function(e){e.value&&(e.textStyle=function(){return t.formatter.getCssText({inline:"img",classes:[e.value]})})})});var w=[{name:"src",type:"filepicker",filetype:"image",label:"Source",autofocus:!0,onchange:s,onbeforecall:function(e){e.meta=m.toJSON()}},p];!1!==t.settings.image_description&&w.push({name:"alt",type:"textbox",label:"Image description"}),t.settings.image_title&&w.push({name:"title",type:"textbox",label:"Image Title"}),x&&w.push({type:"container",label:"Dimensions",layout:"flex",direction:"row",align:"center",spacing:5,items:[{name:"width",type:"textbox",maxLength:5,size:3,onchange:a,ariaLabel:"Width"},{type:"label",text:"x"},{name:"height",type:"textbox",maxLength:5,size:3,onchange:a,ariaLabel:"Height"},{name:"constrain",type:"checkbox",checked:!0,text:"Constrain proportions"}]}),w.push(v),t.settings.image_caption&&e.ceFalse&&w.push({name:"caption",type:"checkbox",label:"Caption"}),t.settings.image_advtab?(u&&(u.style.marginLeft&&u.style.marginRight&&u.style.marginLeft===u.style.marginRight&&(y.hspace=l(u.style.marginLeft)),u.style.marginTop&&u.style.marginBottom&&u.style.marginTop===u.style.marginBottom&&(y.vspace=l(u.style.marginTop)),u.style.borderWidth&&(y.border=l(u.style.borderWidth)),y.style=t.dom.serializeStyle(t.dom.parseStyle(t.dom.getAttrib(u,"style")))),m=t.windowManager.open({title:"Insert/edit image",data:y,bodyType:"tabpanel",body:[{title:"General",type:"form",items:w},{title:"Advanced",type:"form",pack:"start",items:[{label:"Style",name:"style",type:"textbox",onchange:function(){if(t.settings.image_advtab){var e=m.toJSON(),i=b.parseStyle(e.style);m.find("#vspace").value(""),m.find("#hspace").value(""),((i=c(i))["margin-top"]&&i["margin-bottom"]||i["margin-right"]&&i["margin-left"])&&(i["margin-top"]===i["margin-bottom"]?m.find("#vspace").value(l(i["margin-top"])):m.find("#vspace").value(""),i["margin-right"]===i["margin-left"]?m.find("#hspace").value(l(i["margin-right"])):m.find("#hspace").value("")),i["border-width"]&&m.find("#border").value(l(i["border-width"])),m.find("#style").value(b.serializeStyle(b.parseStyle(b.serializeStyle(i))))}}},{type:"form",layout:"grid",packV:"start",columns:2,padding:0,alignH:["left","right"],defaults:{type:"textbox",maxWidth:50,onchange:g},items:[{label:"Vertical space",name:"vspace"},{label:"Horizontal space",name:"hspace"},{label:"Border",name:"border"}]}]}],onSubmit:r})):m=t.windowManager.open({title:"Insert/edit image",data:y,body:w,onSubmit:r})}t.on("preInit",function(){function e(e){var t=e.attr("class");return t&&/\bimage\b/.test(t)}function i(t){return function(i){function a(e){e.attr("contenteditable",t?"true":null)}for(var o,r=i.length;r--;)e(o=i[r])&&(o.attr("contenteditable",t?"false":null),n.each(o.getAll("figcaption"),a))}}t.parser.addNodeFilter("figure",i(!0)),t.serializer.addNodeFilter("figure",i(!1))}),t.addButton("image",{icon:"image",tooltip:"Insert/edit image",onclick:r(l),stateSelector:"img:not([data-mce-object],[data-mce-placeholder]),figure.image"}),t.addMenuItem("image",{icon:"image",text:"Image",onclick:r(l),context:"insert",prependToContext:!0}),t.addCommand("mceImage",r(l))}),function(){}}),i("tinymce.plugins.image.Plugin")()}();